# EAST 实时破裂概率预测方法调研与可复现方案（基于 paper_131）

## 0. 结论先行（给工程实施者）

- **paper_131 的核心贡献**：不是单纯“换更深模型”，而是通过 **PGFE 物理特征提取 + 领域自适应（CORAL）+ 标签质量优化（FLS）+ 标准化参数估计（EFD）**，把跨装置预测从“混合数据硬拼”提升为“物理约束迁移”。
- **单装置（J-TEXT）结果**：PGFE + DART 可达到约 **AUC 0.987 / TPR(>10ms) 96.36% / FPR 2.73%**；只用约 10% 训练数据仍可保持较高性能（AUC 约 0.939）。
- **跨装置（J-TEXT→EAST）结果**：
  - 传统跨装置基线较低（文中示例零迁移约 AUC 0.642）。
  - CORAL 可显著提升，S-CORAL 约到 AUC 0.890。
  - 结合 PGFE-U + FLS 后，少量 EAST 数据可到约 **AUC 0.947**。
  - 进一步 EFD 可做零炮迁移，文中约 **AUC 0.892（约基线 91.6%）**。
- **针对 EAST 毫秒级在线推断的首选方向**：采用“**物理特征前端 + 轻量时序模型后端**”而非端到端大模型；推荐优先落地 **TCN/SSM（Mamba风格简化版）**，Transformer 作为对照与离线增益模型。

---

## 1) paper_131 通读总结：研究思路、问题定义、评价指标、实验设置

## 1.1 研究思路（方法论主线）

论文路线可概括为三步：

1. **先做可解释且高性能的单装置基础模型**（J-TEXT）
   - 用 PGFE 把原始诊断信号加工为有物理含义的特征（MHD、辐射、密度、控制相关）。
   - 分类器选可解释且小样本友好的树模型（DART/GBDT），并用 SHAP 分析贡献。

2. **再做跨装置迁移（J-TEXT→EAST）**
   - 仅靠混合数据不够，采用 **CORAL 域对齐**，并改造成更适合破裂预测任务（S-CORAL）。
   - 目标：在极少 EAST 标签数据下仍可建立可用预测器。

3. **最后提升数据与物理约束质量**
   - **PGFE-U**：优化物理特征工程。
   - **FLS（Floating Labeling Strategy）**：由异常检测辅助每炮“动态前兆标注”，替代一刀切固定窗。
   - **EFD**：估计目标域标准化参数，支持零炮迁移。

> 核心思想：把“难学的装置差异”前移到物理特征和统计对齐层，降低模型末端负担。

## 1.2 问题定义

- 任务本质：二分类破裂预测（disruptive vs non-disruptive），并要求**提前量**满足缓解系统响应。
- 输出形式：逐时刻（timepoint）或逐片段的破裂概率；达到阈值并满足连续报警规则即触发预警。
- 关键约束：
  - **高 TPR + 低 FPR**（工程上需兼顾安全与可用性）；
  - **足够预警提前时间**（文中常用 >10ms、也分析 >30ms 等）；
  - **跨装置可迁移**（目标装置标注数据稀缺）。

## 1.3 评价指标（论文采用）

- **ROC-AUC**：综合阈值性能。
- **TPR / FPR**：在特定阈值下的成功率与误报率。
- **提前时间约束下的 TPR**：如 TPR(>10ms)。
- **累计预警提前时间分布**：看模型在不同 lead time 下的覆盖比例。

## 1.4 实验设置（论文中关键做法）

- J-TEXT 数据：2017-2018 与 2021-2022 跨年度放电，训练/验证/测试分离。
- 时间切片：约 0.1ms 采样切片，使用临近破裂前一段时间窗（如 0.15s）建样本。
- 标签方式：
  - 固定窗策略：如破裂前固定 25ms（J-TEXT）、125ms（EAST）打正样本；
  - FLS：按每炮异常演化动态定义前兆时刻，并设置灰区样本提高标签质量。
- 训练细节：z-score 标准化、样本重加权/下采样处理正负样本不均衡。
- 对比：原始信号模型 vs PGFE 模型、不同迁移策略（无迁移/U-CORAL/S-CORAL）。

---

## 2) EAST 毫秒级在线推断：候选深度学习方案（≥3类）

> 前提：建议统一采用“**PGFE/PGFE-U 物理特征** + 轻量网络”的混合范式，降低延迟、提高鲁棒与可解释性。

## 2.1 候选A：轻量 TCN（首选基线）

**结构**：因果空洞卷积 + 残差块 + 小宽度通道数（如 32~64）+ 单头输出。

- 优点：
  - 并行度高，推断快；
  - 感受野可控，适配 10~200ms 多尺度前兆；
  - 工业部署成熟（ONNX/TensorRT 友好）。
- 缺点：
  - 长程依赖表达不如注意力/SSM；
  - 可解释性主要依赖外部工具（SHAP、特征遮挡）。
- 实时性：**优秀**（CPU/GPU 都容易达 ms 级）。
- 可解释性：**中等**（需配合特征归因）。
- 可部署性：**优秀**。

## 2.2 候选B：线性注意力 Transformer（压缩版）

**结构**：少层（2~4层）Transformer Encoder，局部窗口注意力或线性注意力。

- 优点：
  - 对复杂跨通道依赖建模强；
  - 便于多任务头（破裂概率+提前时间回归）。
- 缺点：
  - 原生注意力开销大，需工程简化；
  - 小数据下更易过拟合。
- 实时性：**中等**（需严格控层数/序列长度）。
- 可解释性：**中等偏上**（注意力图+特征归因）。
- 可部署性：**中等**（需精简后可落地）。

## 2.3 候选C：状态空间模型（S4/Mamba风格简化版）

**结构**：因果 SSM 块 + 门控 MLP，维持流式递推状态（online-friendly）。

- 优点：
  - 长序列效率高，天然适合流式更新；
  - 状态递推适合毫秒级实时系统。
- 缺点：
  - 工程生态较 TCN 弱一些；
  - 超参不当时训练不稳定。
- 实时性：**优秀**（尤其在线递推）。
- 可解释性：**中等**（状态解释难于树模型，但可做通道归因）。
- 可部署性：**中上**（需先做原型验证）。

## 2.4 候选D：时序图模型（可选增强）

**结构**：诊断通道构图（物理耦合边）+ GNN 时序模块（如 ST-GCN/GraphTCN）。

- 优点：
  - 显式编码传感器拓扑与物理关系；
  - 对跨诊断缺失/替换可能更稳健。
- 缺点：
  - 图结构构建成本高；
  - 在线系统复杂度上升。
- 实时性：**中等偏弱**（视图规模而定）。
- 可解释性：**中上**（边权/子图归因）。
- 可部署性：**中等**。

---

## 3) 固定窗 vs AdvancedTime 动态窗：可复现首选方案

> 这里将“AdvancedTime 动态窗”按论文思想落地为：**每炮自适应前兆起点 + 灰区缓冲 + 代价敏感训练**。

## 3.1 推荐首选（可复现）

**方案名**：`PGFE-U + DynamicLabel(AdvancedTime/FLS兼容) + TCN + CORAL`

### 3.1.1 推荐模型栈

1. **前端特征层**：PGFE-U（保持物理可解释通道）。
2. **标签层**：
   - 固定窗作为基线标签；
   - AdvancedTime 动态窗作为主训练标签（可由异常检测/变点检测得到）；
   - 设置灰区样本（ignore index）减少硬边界噪声。
3. **时序主干**：轻量因果 TCN（3~5个残差块，kernel=3~5，dilation 1/2/4/...）。
4. **迁移层**：CORAL（特征协方差对齐）+ 源/目标混合小批次训练。
5. **输出层**：逐时刻破裂概率 + 连续报警逻辑（如连续 N 点超过阈值才触发）。

### 3.1.2 损失函数（建议可直接实现）

总损失：

\[
\mathcal{L}=\lambda_{cls}\mathcal{L}_{WBCE/Focal}+\lambda_{da}\mathcal{L}_{CORAL}+\lambda_{temp}\mathcal{L}_{smooth}
\]

- `L_WBCE/Focal`：类别不平衡（正样本稀少）
- `L_CORAL`：源/目标特征对齐
- `L_smooth`：时间平滑正则，抑制抖动误报

推荐初值：`λcls=1.0, λda=0.1~0.5, λtemp=0.01`。

### 3.1.3 训练/推断流程（复现步骤）

1. 划分数据：按 shot 分层划分 train/val/test，保证跨年度、跨运行场景。
2. 生成两套标签：固定窗标签 + 动态窗标签；灰区置为 ignore。
3. 标准化：z-score；跨装置时目标域可用 EFD 估计参数。
4. 训练顺序：
   - 阶段1：仅源域监督训练（稳定收敛）；
   - 阶段2：加 CORAL 联合训练（少量目标域）；
   - 阶段3：阈值与连续报警长度联合校准（面向 FPR 约束）。
5. 在线部署：滑窗更新 + 单次前向 + 连续N点触发。

---

## 4) 评估协议（必须同时报告 shot-level + timepoint-level）

## 4.1 Shot-level（装置运行视角）

- AUC、TPR、FPR（按 shot 判定）
- TPR@LeadTime>10ms / >30ms / >50ms
- 平均预警提前时间（mean/median lead time）
- 每日误触发次数（工程实用指标）

## 4.2 Timepoint-level（模型行为视角）

- PR-AUC（对类不平衡更敏感）
- 点级 F1 / Recall@固定FPR
- 预警抖动率（alarm toggle per second）
- 检测延迟分布（从前兆开始到首次触发）

## 4.3 阈值策略

- 以“满足安全约束”为主：先锁定 `TPR >= 95%`，再最小化 FPR。
- 使用验证集做阈值与连续报警长度联合搜索（如阈值0.3~0.9，N=3~20点）。

---

## 5) 消融实验设计（建议最小可执行集合）

## 5.1 标签策略消融（你当前最关键）

- A1: 固定窗
- A2: AdvancedTime 动态窗
- A3: 动态窗+灰区
- A4: 动态窗+灰区+时间平滑损失

比较：AUC、TPR@>30ms、FPR、抖动率。

## 5.2 模型结构消融

- B1: DART（论文基线）
- B2: TCN
- B3: 轻量 Transformer
- B4: SSM

比较：性能 + 推断延迟（ms）+ 参数量 + CPU占用。

## 5.3 迁移策略消融

- C1: 无迁移（直接零迁移）
- C2: 混合数据
- C3: CORAL
- C4: CORAL + EFD

比较：少样本下性能退化曲线（目标域 0/5/10/20 破裂炮）。

## 5.4 物理特征消融

- D1: 全特征
- D2: 去MHD类
- D3: 去辐射类
- D4: 去密度/控制类

比较：性能下降幅度 + SHAP 通道重要性稳定性。

---

## 6) 工程部署建议（面向毫秒级在线）

- 模型输入固定长度（如最近 128~256 点）。
- ONNX 导出，INT8/FP16 量化，目标单次前向 <1ms（GPU）或 <3ms（CPU）。
- 双阈值机制：`预警阈值` + `触发阈值`，并加最小保持时间，降低抖动。
- 在线监控四项：TPR、FPR、平均提前时间、分布漂移（特征均值/方差）。
- 建议保留“可解释旁路”：实时输出 top-k 物理特征贡献，便于值班判断。

---

## 7) 最终推荐（给当前 EAST 项目）

若目标是“**尽快上线 + 可复现 + 可维护**”，优先顺序：

1. **主线**：`PGFE-U + AdvancedTime动态标签 + 轻量TCN + CORAL`（首选）
2. **并行对照**：`PGFE-U + DART + CORAL`（强可解释基线）
3. **中期升级**：在主线稳定后引入 `SSM`，争取更长提前量与更低算力。

这一路线与 paper_131 的成功经验一致，同时满足 EAST 实时部署的工程约束。